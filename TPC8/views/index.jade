extends layout

block content
  
  script(src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js")
  script.
    function format(p){
      return `<p id=${p._id}><small>
      <button id=${'edit/' + p._id}>Edit</button>
      <button id=${'delete/' + p._id}>Delete</button>
      ${p.date} | </small>
      <span id=${'para/' + p._id}> ${p.para} </span>
      </p>
      <form style="display:none" id=${'form/' + p._id}>
        <small>
        <button id=${'ok/' + p._id}>Ok</button>
        <button id=${'cancel/' + p._id}>Cancel</button>
        </small>
        <input type="text" id=${'input/' + p._id}>
      </form>`
    }

    function edit(id, edit){
      
      if (edit){
        $("#form/" + id).show()
        $("#" + id).hide()
      }
      else{
        $("#form/" + id).hide()
        $("#" + id).show()
      }   
    }

    $(function(){

      $.get('http://localhost:3000/paras', function(data){
        data.forEach(p => {
          $("#paraList").append(format(p));
        });
      });

      $("#addPara").click(function(){
        $.post('http://localhost:3000/paras', $("#myParaForm").serialize())
        alert('Record inserted: ' + JSON.stringify($("#myParaForm").serialize() ))
        $("#paraText").val("");
      });

      $("#paraList").click(function() {
        let info = event.target.id.split('/')
        let type = info[0]
        let id = info[1]
        
        switch (type){
          
          case "delete":
            $.ajax({
              type: "DELETE",
              url: "http://localhost:3000/paras/" + id,   
              success: function() {
                $("#" + id).remove()
              }
            });
            break;
          
          case "edit":
            edit(id, true);
            break;

          case "cancel":
            edit(id, false);
            break;

          case "ok":
            $.get("http://localhost:3000/paras/" + id, function(data){
              data["para"] = $("#input/" + id).val();
              $.ajax({
                type: "PUT",
                url: "http://localhost:3000/paras/" + id,
                data: data,
                success: function() {
                    $("#" + id).text(data["para"])
                    edit(id, false)
                }
              })
            });
            break;

          default:
            break;
        }  
      })

    });

  .w3-container.w3-margin
    .w3-card-4
      header.w3-container.w3-teal
        h3 Adicionar Parágrafos

      form.w3-container.w3-margin(style="padding:10px", id="myParaForm")

        .w3-row.w3-margin-bottom
          .w3-col.s2
            b
              label.w3-text-teal Parágrafo:
          .w3-col.s9.w3-border
            input.w3-input(type="text", id="paraText", name="para")

        .w3-row.w3-margin-top
            input.w3-btn.w3-teal(type="submit", id="addPara", value="Add")

  .w3-container.w3-margin
    .w3-card-4
      header.w3-container.w3-teal
        h3 Parágrafos
      .w3-container(style="padding:10px 80px", id="paraList")
